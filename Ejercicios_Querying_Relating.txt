




-- uso de SLECT, FROM, WHERE, LIMIT 
SELECT first_name, height, weight, city
FROM patients
where (height > 170 AND height <> 180) or weight =='Ajax'
LIMIT 6;





-- uso de NUll, LIKE, ORDER BY
SELECT * 
FROM patients
where allergies is NOT NULL AND (first_name like 'AN%' OR first_name LIKE '____')
order by first_name DESC





/* MAX(), MIN(), AVG(), COUNT(), SUM(), AS ""  */

SELECT MAX(height) As "Max Height", MIN (height) AS "Min Height",ROUND(AVG(weight),2) AS "AVG Weight"
FROM patients

SELECT SUM(gender=="M") AS "Hombres", SUM(gender=="F") AS "Women“
FROM patients

SELECT count(*) AS "Total allergies",
count(allergies) AS "Valid files",
count(distinct allergies) AS "Nume allergies"
FROM patients

SELECT allergies, count(*)
FROM patients
group by allergies
order by count(*)



/*  SUBQUERY 
Show unique first names from the patients table which only occurs once in the list. */
SELECT first_name
FROM (
	SELECT first_name,count(*) AS "name" 
	FROM patients
	group by first_name)
WHERE name<2

-- SUBQUERY WHERE
/* Encuentra todos los pacientes que son más altos que el promedio de altura.*/
select first_name, last_name, height
from patients
where height> (
	select AVG(HEIGHT)
	FROM patients)

-- SUBQUERY IN
-- Encuentra todos los pacientes que viven en una de estas 
-- 3 ciudades específicas: 'AB', 'QC', o 'SK'.
SELECT first_name, city, province_id
FROM patients
where province_id IN ("SK","QC","AB")
order by province_id ASC

-- SUBQUERY FROM
-- Encuentra peso y altura promedio por genero
SELECT *
FROM (
  select gender, AVG(weight), AVG(height)
  from patients
  group by gender)

-- SUBQUERY SELECT
/*  Muestra cada paciente con: first_name, last_name, city, weight (su peso)
La diferencia entre su peso y el peso promedio de su ciudad  */
select p1.first_name, p1.last_name, p1.city,weight,	
    (SELECT AVG(p2.weight)
    FROM patients p2
    where p1.city=p2.city
    )- p1.weight as deficit_peso
FROM patients AS p1


  /* Encuentra todos los pacientes que tienen una altura 
     que aparece más de 5 veces en la base de datos     */
select first_name, last_name, height
FROM patients
WHERE height in ( 
  SELECT height
  FROM(
    select height, count(height) AS alk
    FRom patients
    group by height
  )
  WHERE alk >5
  )
 

/*   Obtén un reporte que muestre cada género junto con:El peso promedio de ese género,
La altura promedio de ese género,El IMC promedio de ese género (IMC = peso / (altura/100)²)
PERO solo para aquellos géneros donde el peso promedio sea mayor a 70 kg.   */
select *
from (
	SELECT gender, round(AVG(weight),2) As weight_avg, ROUND(AVG(height),2) As height_avg,
    round(AVG(weight)/power(AVG(height)/100,2),2) as imc
  	from patients
    group by gender
)
WHERE weight_avg>70


/*  Muestra cada paciente con:
first_name, last_name, birth_date, Su edad actual (calculada)
Cuántos pacientes en TOTAL son mayores que él/ella (más viejos)*/
SELECT 
    p1.first_name, 
    p1.last_name, 
    p1.birth_date,
    YEAR(CURRENT_TIMESTAMP) - YEAR(p1.birth_date) AS age,
    (SELECT COUNT(*)
     FROM patients p2
     WHERE p2.birth_date < p1.birth_date) AS pacientes_mayores
FROM patients p1
ORDER BY p1.birth_date ASC;



-- Show patient_id and first_name from patients where 
-- their first_name start and ends with 's' and is at least 6 characters long
select patient_id, first_name
from patients
WHERE first_name like "s%" AND first_name like "%s" AND length(first_name)>=6
--where first_name like "s____%s" 







SELECT *
FROM patients
JOIN province_names on patients.province_id = province_names.province_id


-- Show patient_id, first_name, last_name 
-- from patients whos diagnosis is 'Dementia'.
-- Primary diagnosis is stored in the admissions table.
select patients.patient_id, first_name, last_name
from patients
JOIN admissions ON patients.patient_id=admissions.patient_id
WHERE diagnosis="Dementia"


